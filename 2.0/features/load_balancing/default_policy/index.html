<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="A pure Ruby client for Apache Cassandra">
    <meta name="author" content="DataStax">

    <title>Ruby Driver for Apache Cassandra - Default Load Balancing Policy</title>

    <link rel="icon" href="../../../../favicon.ico">
    <link rel="apple-touch-icon" href="../../../../favicon.png">
    <link href="../../../../css/style.css" rel="stylesheet">
    <link href="../../../../css/pygments.css" rel="stylesheet">
    <link href="../../../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs">
    <div class="navbar">
      <div class="container-fluid">
        <div class="row row-offcanvas row-offcanvas-left">
          <div class="col-sm-3 text-center">
            <a class="ds-home" href="../../../"><img alt="Brand" src="../../../../img/logo.png"></a>
            <ul class="list-inline ds-sites" role="nav">
              <li><a href="https://academy.datastax.com/" class="navbar-link">DataStax Academy</a></li>
              <li><a href="http://www.datastax.com/dev/blog" class="navbar-link">Tech Blog</a></li>
              <li><a href="http://www.datastax.com/what-we-offer/products-services/support" class="navbar-link">Support</a></li>
            </ul>
          </div>
          <div class="col-md-5">
            <p class="lead pubtitle">Ruby Driver for Apache Cassandra</p>
            
            <div class="text-info">
              <span class="text-warning">Attention:</span> Viewing documentation for version
              <div class="btn-group">
                <button id="current-version" class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  2.0
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                
                  <li><a href="../../../../features/load_balancing/default_policy/">3.2</a></li>
                
                  <li><a href="../../../../3.1/features/load_balancing/default_policy/">3.1</a></li>
                
                  <li><a href="../../../../3.0/features/load_balancing/default_policy/">3.0</a></li>
                
                  <li><a href="../../../../2.1/features/load_balancing/default_policy/">2.1</a></li>
                
                  <li class="disabled"><a href="./">2.0</a></li>
                
                  <li><a href="../../../../1.2/features/load_balancing/default_policy/">1.2</a></li>
                
                  <li><a href="../../../../1.1/features/load_balancing/default_policy/">1.1</a></li>
                
                  <li><a href="../../../../1.0/features/load_balancing/default_policy/">1.0</a></li>
                
                </ul>
              </div>
              <span class="red">
              
              (Earlier version)
              
              </span>
            </div>
            
          </div>
          <div class="col-md-4">
            <form id="search" class="form-search dropdown visible-lg-inline-block" ng-controller="search" ng-class="{open: hasResults}" role="search" ng-submit="submit()" data-spy="affix" data-offset-top="130">
              <div class="form-group has-feedback">
                <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('2.0')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
              </div>
              <ul class="dropdown-menu search-results" role="menu">
                <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
              </ul>
            </form>
            <a href="http://www.datastax.com/download" class="btn btn-primary btn-sm">Download</a>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid" id="content">
      <div class="row">
        <div class="col-md-3">
          <div id="navigation" class="side-nav" role="tablist" aria-multiselectable="true">
            <h3><a href="../../../">Contents</a></h3>
            <ul class="nav nav-pills nav-stacked">
  
  
  <li class="active">
    <a href="../../">
      Usage <small>page</small>
      
      
      <span class="glyphicon glyphicon-minus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
  
  <li>
    <a href="../../basics/">
      Basics <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../asynchronous_io/">
      Asynchronous IO <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../security/">
      Security <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../debugging/">
      Debugging <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li class="active">
    <a href="../">
      Load Balancing <small>page</small>
      
      
      <span class="glyphicon glyphicon-minus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
  
  <li class="active">
    <a href="./" class="current">
      Default Load Balancing Policy <small>feature</small>
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
</ul>

  </li>
  
  
  <li>
    <a href="../round_robin/">
      Round Robin Policy <small>feature</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../datacenter_aware/">
      Datacenter-aware Round Robin Policy <small>feature</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../token_aware/">
      Token-aware Load Balancing Policy <small>feature</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../whitelist/">
      White List Policy <small>feature</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../implementing_a_policy/">
      Implementing custom load balancing policies <small>feature</small>
      
    </a>
    
  </li>
  
</ul>

  </li>
  
  
  <li>
    <a href="../../retry_policies/">
      Retry Policies <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../state_listeners/">
      State Listeners <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../address_resolution/">
      Address resolution <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../error_handling/">
      Error Handling <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../reconnection/">
      Reconnection <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
</ul>

  </li>
  
  
  <li>
    <a href="../../../api/">
      API docs <small>index</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
</ul>

          </div>
        </div>
        <div class="col-md-9 content">
          <div class="crumbs-wrapper">
            <nav id="crumbs" data-spy="affix" data-offset-top="130">
              <ol class="breadcrumb">
                
                
                
                <li><a href="../../../">Home</a></li>
                
                
                
                
                
                <li><a href="../../">Usage</a></li>
                
                
                
                
                
                <li><a href="../">Load Balancing</a></li>
                
                
                
                
                
                <li class="active">Default Load Balancing Policy</li>
                
                
                
              </ol>
            </nav>
          </div>
          
<div class="feature-section">
<h1 id="default-load-balancing-policy" class="target">Default Load Balancing Policy<a class="anchor" href="#default-load-balancing-policy" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h1>
<p>By default, Ruby driver will use a combination of Token aware and Data Center
aware round robin policies for load balancing.</p>

<p>This combination proved to be the most performant of of all built-in load
balancing policies.</p>

<p>When the name of the local data center is not specified explicitly using
<a href="../../../api/cassandra/#cluster-class_method"><code>Cassandra.cluster</code></a>, the first datacenter seen
by the load balancing policy will be considered local. Therefore, care must
be taken to only include addresses of the nodes in the same datacenter as the
application using the Ruby Driver in the <code>:hosts</code> option to 
<code>Cassandra.cluster</code>, or to provide <code>:datacenter</code> option explicitly.</p>
<h2 id="background" class="target">Background<a class="anchor" href="#background" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster in 2 datacenters with 2 nodes in each</dd>
<dt>And </dt>
<dd>the following schema:<pre class="highlight"><code class="cql"><span class="k">CREATE</span> <span class="k">KEYSPACE</span> <span class="n">simplex</span> <span class="k">WITH</span> <span class="n">replication</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'class'</span><span class="p">:</span> <span class="s1">'NetworkTopologyStrategy'</span><span class="p">,</span> <span class="s1">'dc1'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">,</span> <span class="s1">'dc2'</span><span class="p">:</span> <span class="s1">'1'</span><span class="p">};</span>
<span class="k">USE</span> <span class="n">simplex</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">songs</span> <span class="p">(</span>
  <span class="n">id</span> <span class="k">uuid</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">title</span> <span class="k">text</span><span class="p">,</span>
  <span class="n">album</span> <span class="k">text</span><span class="p">,</span>
  <span class="n">artist</span> <span class="k">text</span><span class="p">,</span>
  <span class="n">tags</span> <span class="k">set</span><span class="o">&lt;</span><span class="k">text</span><span class="o">&gt;</span><span class="p">,</span>
  <span class="n">data</span> <span class="k">blob</span>
<span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">songs</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">album</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span>
   <span class="mi">756716f7-2e54-4715-9f00-91dcbea6cf50</span><span class="p">,</span>
   <span class="s1">'La Petite Tonkinoise'</span><span class="p">,</span>
   <span class="s1">'Bye Bye Blackbird'</span><span class="p">,</span>
   <span class="s1">'Joséphine Baker'</span><span class="p">,</span>
   <span class="p">{</span><span class="s1">'jazz'</span><span class="p">,</span> <span class="s1">'2013'</span><span class="p">})</span>
<span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">songs</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">album</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span>
   <span class="mi">f6071e72-48ec-4fcb-bf3e-379c8a696488</span><span class="p">,</span>
   <span class="s1">'Die Mösch'</span><span class="p">,</span>
   <span class="s1">'In Gold'</span><span class="p">,</span>
   <span class="s1">'Willi Ostermann'</span><span class="p">,</span>
   <span class="p">{</span><span class="s1">'kölsch'</span><span class="p">,</span> <span class="s1">'1996'</span><span class="p">,</span> <span class="s1">'birds'</span><span class="p">}</span>
<span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">songs</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">album</span><span class="p">,</span> <span class="n">artist</span><span class="p">,</span> <span class="n">tags</span><span class="p">)</span>
<span class="k">VALUES</span> <span class="p">(</span>
   <span class="mi">fbdf82ed-0063-4796-9c7c-a3d4f47b4b25</span><span class="p">,</span>
   <span class="s1">'Memo From Turner'</span><span class="p">,</span>
   <span class="s1">'Performance'</span><span class="p">,</span>
   <span class="s1">'Mick Jager'</span><span class="p">,</span>
   <span class="p">{</span><span class="s1">'soundtrack'</span><span class="p">,</span> <span class="s1">'1991'</span><span class="p">}</span>
<span class="p">);</span>
</code></pre>
</dd>
</dl>
<h2 id="default-load-balancing-policy-always-routes-to-primary-replicas-when-possible" class="target">Default load balancing policy always routes to primary replicas when possible<a class="anchor" href="#default-load-balancing-policy-always-routes-to-primary-replicas-when-possible" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="n">cluster</span>   <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">hosts: </span><span class="p">[</span><span class="s1">'127.0.0.1'</span><span class="p">,</span> <span class="s1">'127.0.0.2'</span><span class="p">])</span>
<span class="n">session</span>   <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="s1">'simplex'</span><span class="p">)</span>
<span class="n">statement</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">"SELECT token(id) FROM songs WHERE id = ?"</span><span class="p">)</span>

<span class="n">coordinator_ips</span> <span class="o">=</span> <span class="mi">4</span><span class="p">.</span><span class="nf">times</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span>
  <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="ss">arguments: </span><span class="p">[</span><span class="no">Cassandra</span><span class="o">::</span><span class="no">Uuid</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'756716f7-2e54-4715-9f00-91dcbea6cf50'</span><span class="p">)]).</span><span class="nf">execution_info</span>
  <span class="n">info</span><span class="p">.</span><span class="nf">hosts</span><span class="p">.</span><span class="nf">last</span><span class="p">.</span><span class="nf">ip</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">coordinator_ips</span><span class="p">.</span><span class="nf">sort</span><span class="p">.</span><span class="nf">uniq</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>127.0.0.2
</code></pre>
</dd>
</dl>
<h2 id="default-load-balancing-policy-always-uses-primary-replicas-from-the-local-datacenter" class="target">Default load balancing policy always uses primary replicas from the local datacenter<a class="anchor" href="#default-load-balancing-policy-always-uses-primary-replicas-from-the-local-datacenter" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="n">cluster</span>   <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">hosts: </span><span class="p">[</span><span class="s1">'127.0.0.3'</span><span class="p">,</span> <span class="s1">'127.0.0.4'</span><span class="p">])</span>
<span class="n">session</span>   <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="s1">'simplex'</span><span class="p">)</span>
<span class="n">statement</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">"SELECT token(id) FROM songs WHERE id = ?"</span><span class="p">)</span>

<span class="n">coordinator_ips</span> <span class="o">=</span> <span class="mi">4</span><span class="p">.</span><span class="nf">times</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span>
  <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="ss">arguments: </span><span class="p">[</span><span class="no">Cassandra</span><span class="o">::</span><span class="no">Uuid</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'756716f7-2e54-4715-9f00-91dcbea6cf50'</span><span class="p">)]).</span><span class="nf">execution_info</span>
  <span class="n">info</span><span class="p">.</span><span class="nf">hosts</span><span class="p">.</span><span class="nf">last</span><span class="p">.</span><span class="nf">ip</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">coordinator_ips</span><span class="p">.</span><span class="nf">sort</span><span class="p">.</span><span class="nf">uniq</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>127.0.0.4
</code></pre>
</dd>
</dl>
<h2 id="default-load-balancing-allows-specifying-data-center-explicitly" class="target">Default load balancing allows specifying data center explicitly<a class="anchor" href="#default-load-balancing-allows-specifying-data-center-explicitly" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="n">cluster</span>   <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span>
              <span class="ss">datacenter: </span><span class="s1">'dc1'</span><span class="p">,</span>
              <span class="ss">hosts: </span><span class="p">[</span><span class="s1">'127.0.0.3'</span><span class="p">,</span> <span class="s1">'127.0.0.4'</span><span class="p">]</span>
            <span class="p">)</span>
<span class="n">session</span>   <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="s1">'simplex'</span><span class="p">)</span>
<span class="n">statement</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">prepare</span><span class="p">(</span><span class="s2">"SELECT token(id) FROM songs WHERE id = ?"</span><span class="p">)</span>

<span class="n">coordinator_ips</span> <span class="o">=</span> <span class="mi">4</span><span class="p">.</span><span class="nf">times</span><span class="p">.</span><span class="nf">map</span> <span class="k">do</span>
  <span class="n">info</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="ss">arguments: </span><span class="p">[</span><span class="no">Cassandra</span><span class="o">::</span><span class="no">Uuid</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'756716f7-2e54-4715-9f00-91dcbea6cf50'</span><span class="p">)]).</span><span class="nf">execution_info</span>
  <span class="n">info</span><span class="p">.</span><span class="nf">hosts</span><span class="p">.</span><span class="nf">last</span><span class="p">.</span><span class="nf">ip</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="n">coordinator_ips</span><span class="p">.</span><span class="nf">sort</span><span class="p">.</span><span class="nf">uniq</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>127.0.0.2
</code></pre>
</dd>
</dl>
<h2 id="default-load-balancing-policy-prevents-requests-to-remote-datacenters" class="target">Default load balancing policy prevents requests to remote datacenters<a class="anchor" href="#default-load-balancing-policy-prevents-requests-to-remote-datacenters" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="n">cluster</span>   <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span>
              <span class="ss">hosts: </span><span class="p">[</span><span class="s1">'127.0.0.1'</span><span class="p">,</span> <span class="s1">'127.0.0.2'</span><span class="p">]</span>
            <span class="p">)</span>
<span class="n">session</span>   <span class="o">=</span> <span class="n">cluster</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="s1">'simplex'</span><span class="p">)</span>
<span class="n">statement</span> <span class="o">=</span> <span class="s2">"SELECT token(id) FROM songs"</span>

<span class="vg">$stdout</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span><span class="s2">"=== START ==="</span><span class="p">)</span>
<span class="vg">$stdout</span><span class="p">.</span><span class="nf">flush</span>

<span class="vg">$stdin</span><span class="p">.</span><span class="nf">gets</span> <span class="c1"># ready, block on stdin</span>

<span class="k">begin</span>
  <span class="n">execution_info</span> <span class="o">=</span> <span class="n">session</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">statement</span><span class="p">).</span><span class="nf">execution_info</span>
  <span class="vg">$stdout</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span><span class="s2">"Statement </span><span class="si">#{</span><span class="n">statement</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2"> fulfilled by </span><span class="si">#{</span><span class="n">execution_info</span><span class="p">.</span><span class="nf">hosts</span><span class="p">.</span><span class="nf">last</span><span class="p">.</span><span class="nf">ip</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="vg">$stdout</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
<span class="vg">$stdout</span><span class="p">.</span><span class="nf">flush</span>
<span class="vg">$stdout</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span><span class="s2">"=== STOP ==="</span><span class="p">)</span>
<span class="vg">$stdout</span><span class="p">.</span><span class="nf">flush</span>
</code></pre>
</dd>
<dt>And </dt>
<dd>it is running interactively</dd>
<dt>And </dt>
<dd>I wait for its output to contain &#8220;START&#8221;</dd>
<dt>When </dt>
<dd>node 1 stops</dd>
<dt>And </dt>
<dd>node 2 stops</dd>
<dt>And </dt>
<dd>I close the stdin stream</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>Cassandra::Errors::NoHostsAvailable: All hosts down
</code></pre>
</dd>
</dl>
</div>

        </div>
      </div>
    </div>

    
    <footer class="container text-muted">
      <ul class="list-inline">
      
        
        <li>
          <a href="https://github.com/datastax/ruby-driver/">Code</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="http://docs.datastax.com/en/developer/ruby-driver/">Docs</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://datastax-oss.atlassian.net/browse/RUBY/">Issues</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://groups.google.com/a/lists.datastax.com/forum/#!forum/ruby-driver-user">Mailing List</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="irc://irc.freenode.net/datastax-drivers">IRC Channel</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://github.com/datastax/ruby-driver/releases">Releases</a>
        </li>
      
      </ul>
    </footer>
    

    <script src="../../../../js/jquery.js"></script>
    <script src="../../../../js/bootstrap.js"></script>
    <script src="../../../../js/angular.js"></script>
    <script src="../../../../js/mousetrap.js"></script>
    <script src="../../../../js/hotkeys.js"></script>
    <script src="../../../../js/ZeroClipboard.js"></script>
    <script src="../../../../js/lunr.js"></script>
    <script src="../../../../js/app.js"></script>
  </body>
</html>
