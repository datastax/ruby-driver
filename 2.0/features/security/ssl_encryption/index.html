<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="A pure Ruby client for Apache Cassandra">
    <meta name="author" content="DataStax">

    <title>Ruby Driver for Apache Cassandra - SSL encryption</title>

    <link rel="icon" href="../../../../favicon.ico">
    <link rel="apple-touch-icon" href="../../../../favicon.png">
    <link href="../../../../css/style.css" rel="stylesheet">
    <link href="../../../../css/pygments.css" rel="stylesheet">
    <link href="../../../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs">
    <div class="navbar">
      <div class="container-fluid">
        <div class="row row-offcanvas row-offcanvas-left">
          <div class="col-sm-3 text-center">
            <a class="ds-home" href="../../../"><img alt="Brand" src="../../../../img/logo.png"></a>
            <ul class="list-inline ds-sites" role="nav">
              <li><a href="https://academy.datastax.com/" class="navbar-link">DataStax Academy</a></li>
              <li><a href="http://www.datastax.com/dev/blog" class="navbar-link">Tech Blog</a></li>
              <li><a href="http://www.datastax.com/what-we-offer/products-services/support" class="navbar-link">Support</a></li>
            </ul>
          </div>
          <div class="col-md-5">
            <p class="lead pubtitle">Ruby Driver for Apache Cassandra</p>
            
            <div class="text-info">
              <span class="text-warning">Attention:</span> Viewing documentation for version
              <div class="btn-group">
                <button id="current-version" class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  2.0
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                
                  <li><a href="../../../../features/security/ssl_encryption/">3.2</a></li>
                
                  <li><a href="../../../../3.1/features/security/ssl_encryption/">3.1</a></li>
                
                  <li><a href="../../../../3.0/features/security/ssl_encryption/">3.0</a></li>
                
                  <li><a href="../../../../2.1/features/security/ssl_encryption/">2.1</a></li>
                
                  <li class="disabled"><a href="./">2.0</a></li>
                
                  <li><a href="../../../../1.2/features/security/ssl_encryption/">1.2</a></li>
                
                  <li><a href="../../../../1.1/features/security/ssl_encryption/">1.1</a></li>
                
                  <li><a href="../../../../1.0/features/security/ssl_encryption/">1.0</a></li>
                
                </ul>
              </div>
              <span class="red">
              
              (Earlier version)
              
              </span>
            </div>
            
          </div>
          <div class="col-md-4">
            <form id="search" class="form-search dropdown visible-lg-inline-block" ng-controller="search" ng-class="{open: hasResults}" role="search" ng-submit="submit()" data-spy="affix" data-offset-top="130">
              <div class="form-group has-feedback">
                <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('2.0')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
              </div>
              <ul class="dropdown-menu search-results" role="menu">
                <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
              </ul>
            </form>
            <a href="http://www.datastax.com/download" class="btn btn-primary btn-sm">Download</a>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid" id="content">
      <div class="row">
        <div class="col-md-3">
          <div id="navigation" class="side-nav" role="tablist" aria-multiselectable="true">
            <h3><a href="../../../">Contents</a></h3>
            <ul class="nav nav-pills nav-stacked">
  
  
  <li class="active">
    <a href="../../">
      Usage <small>page</small>
      
      
      <span class="glyphicon glyphicon-minus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
  
  <li>
    <a href="../../basics/">
      Basics <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../asynchronous_io/">
      Asynchronous IO <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li class="active">
    <a href="../">
      Security <small>page</small>
      
      
      <span class="glyphicon glyphicon-minus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
  
  <li>
    <a href="../standard_authentication/">
      Standard authentication <small>feature</small>
      
    </a>
    
  </li>
  
  
  <li class="active">
    <a href="./" class="current">
      SSL encryption <small>feature</small>
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
</ul>

  </li>
  
</ul>

  </li>
  
  
  <li>
    <a href="../../debugging/">
      Debugging <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../load_balancing/">
      Load Balancing <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../retry_policies/">
      Retry Policies <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../state_listeners/">
      State Listeners <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../address_resolution/">
      Address resolution <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../error_handling/">
      Error Handling <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../reconnection/">
      Reconnection <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
</ul>

  </li>
  
  
  <li>
    <a href="../../../api/">
      API docs <small>index</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
</ul>

          </div>
        </div>
        <div class="col-md-9 content">
          <div class="crumbs-wrapper">
            <nav id="crumbs" data-spy="affix" data-offset-top="130">
              <ol class="breadcrumb">
                
                
                
                <li><a href="../../../">Home</a></li>
                
                
                
                
                
                <li><a href="../../">Usage</a></li>
                
                
                
                
                
                <li><a href="../">Security</a></li>
                
                
                
                
                
                <li class="active">SSL encryption</li>
                
                
                
              </ol>
            </nav>
          </div>
          
<div class="feature-section">
<h1 id="ssl-encryption" class="target">SSL encryption<a class="anchor" href="#ssl-encryption" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h1>
<p>There are a few levels of security that SSL encryption can provide when
communicating with Apache Cassandra. You can find them below in the
increasing security order: the first being the least secure and the last -
the most.</p>

<ol>
<li>Using default SSL context. This method is actually not secure as there is
no peer validation happening. <code>Cassandra.cluster(ssl: true)</code>
</li>
<li>Using shared certificate authority. This method is more secure than the
previous one, because the client is able to validate the identity of the
server. Using this method the server can’t trust the client unless
additional authentication has been provided.
<code>Cassandra.cluster(server_cert: '/path/to/ca.pem')</code>
</li>
<li>Using trusted client certificates. This method, in addition to peer
verification, allows server to validate identities of the clients. Make
sure to enable <code>client_encryption_options.require_client_auth</code> setting in
<code>cassandra.yaml</code>, as well as add all trusted client keys to Apache
Cassandra’s truststore. You can use server certificate as well as client
certificate and private key with an optional passphrase to connect to
Apache Cassandra. <code>Cassandra.cluster(server_cert: '/path/to/ca.pem', client_cert: '/path/to/client.pem', private_key: '/path/to/client.key', passphrase:  'secret passphrase for private key')</code>
</li>
</ol>
<h2 id="using-default-ssl-encryption" class="target">Using default SSL encryption<a class="anchor" href="#using-default-ssl-encryption" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">ssl: </span><span class="kp">true</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful
</code></pre>
</dd>
</dl>
<h2 id="connection-fails-when-not-using-ssl-encryption" class="target">Connection fails when not using SSL encryption<a class="anchor" href="#connection-fails-when-not-using-ssl-encryption" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">ssl: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">connect_timeout: </span><span class="mi">2</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection failed
</code></pre>
</dd>
</dl>
<h2 id="using-an-ssl-certificate-authority" class="target">Using an SSL certificate authority<a class="anchor" href="#using-an-ssl-certificate-authority" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">server_cert: </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'SERVER_CERT'</span><span class="p">])</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed with a valid ca path in the environment</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful
</code></pre>
</dd>
</dl>
<h2 id="using-ssl-authentication" class="target">Using SSL authentication<a class="anchor" href="#using-ssl-authentication" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL client authentication enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span>
    <span class="ss">server_cert:  </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'SERVER_CERT'</span><span class="p">],</span>
    <span class="ss">client_cert:  </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'CLIENT_CERT'</span><span class="p">],</span>
    <span class="ss">private_key:  </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'PRIVATE_KEY'</span><span class="p">],</span>
    <span class="ss">passphrase:   </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'PASSPHRASE'</span><span class="p">]</span>
  <span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed with ca and cert path and key in the environment</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful
</code></pre>
</dd>
</dl>
<h2 id="using-a-custom-ssl-context" class="target">Using a custom SSL context<a class="anchor" href="#using-a-custom-ssl-context" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code class="ruby"><span class="nb">require</span> <span class="s1">'cassandra'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">ssl: </span><span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">SSLContext</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful
</code></pre>
</dd>
</dl>
</div>

        </div>
      </div>
    </div>

    
    <footer class="container text-muted">
      <ul class="list-inline">
      
        
        <li>
          <a href="https://github.com/datastax/ruby-driver/">Code</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="http://docs.datastax.com/en/developer/ruby-driver/">Docs</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://datastax-oss.atlassian.net/browse/RUBY/">Issues</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://groups.google.com/a/lists.datastax.com/forum/#!forum/ruby-driver-user">Mailing List</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="irc://irc.freenode.net/datastax-drivers">IRC Channel</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://github.com/datastax/ruby-driver/releases">Releases</a>
        </li>
      
      </ul>
    </footer>
    

    <script src="../../../../js/jquery.js"></script>
    <script src="../../../../js/bootstrap.js"></script>
    <script src="../../../../js/angular.js"></script>
    <script src="../../../../js/mousetrap.js"></script>
    <script src="../../../../js/hotkeys.js"></script>
    <script src="../../../../js/ZeroClipboard.js"></script>
    <script src="../../../../js/lunr.js"></script>
    <script src="../../../../js/app.js"></script>
  </body>
</html>
